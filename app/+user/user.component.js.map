{"version":3,"file":"user.component.js","sourceRoot":"","sources":["user.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { Control } from '@angular/common';\nimport { Observable } from 'rxjs';\nimport 'rxjs/add/operator/debounceTime';\nimport 'rxjs/add/operator/distinctUntilChanged';\nimport 'rxjs/add/operator/switchMap';\nimport { ROUTER_DIRECTIVES} from '@angular/router';\n\nimport { User, UserService } from '../user';\nimport { Book, BookService, TradeRequest } from '../book';\nimport { BookListComponent } from '../book-list/book-list.component';\nimport { BS_PANEL_DIRECTIVES } from '../bootstrap-panel';\n\n\n@Component({\n  moduleId: module.id,\n  selector: 'app-user',\n  templateUrl: 'user.component.html',\n  directives: [BookListComponent, BS_PANEL_DIRECTIVES, ROUTER_DIRECTIVES]\n})\nexport class UserComponent implements OnInit {\n\n  private user:User;\n  private books:Observable<Book[]>;\n  \n  private requestsFromMe:TradeRequest[];\n  private requestsByMe:TradeRequest[];\n  \n  \n  private searchBook = new Control();\n  private searchBooksResults:Book[] = [];\n  private queryUnderway:boolean = false;\n  \n  private showProfile:boolean = false;\n  private name = new Control();\n  private city = new Control();\n  private state = new Control();\n  \n  \n  constructor(private userService:UserService, private bookService:BookService) { }\n\n  ngOnInit() {\n    this.userService.user\n      .subscribe(u => {\n        this.user = u;\n        this.books = this.bookService.userBooks;\n        this.bookService.getTradeRequestsFrom(u).subscribe(r => this.requestsFromMe = r);\n        this.bookService.getTradeRequestsBy(u).subscribe(r => this.requestsByMe = r);\n        this.setControlValues();\n      });\n       \n    this.searchBook\n      .valueChanges\n      .map(e => { this.queryUnderway = true; return e })\n      .debounceTime(400)\n      .distinctUntilChanged()\n      .switchMap(query => this.bookService.findBooks(query))\n      .subscribe(r => { console.log(\"got result: \" + r); this.queryUnderway = false; this.searchBooksResults = r });\n  }\n\n  deleteBook(book:Book) {\n    this.bookService.deleteBook(this.user, book);\n  }\n  addBook(book:Book) {\n    this.bookService.addBook(this.user, book);\n    this.searchBook.updateValue(\"\");\n  }\n  \n  private toggleProfile() {\n    this.showProfile = !this.showProfile;\n  }\n  \n  private saveProfile() {\n    this.toggleProfile();\n    this.user.name = this.name.value;\n    this.user.city = this.city.value;\n    this.user.state = this.state.value;\n    this.userService.updateUserData(this.user);\n  }\n  \n  private cancel() {\n    this.toggleProfile();\n    this.setControlValues();\n  }\n  \n  private setControlValues() {\n    this.name.updateValue(this.user ? this.user.name : \"\");\n    this.city.updateValue(this.user ? this.user.city : \"\");\n    this.state.updateValue(this.user ? this.user.state : \"\");\n  }\n  \n  private acceptRequest(request:TradeRequest) {\n    this.bookService.updateRequestStatus(request, 'accepted')\n  }\n  \n  private declineRequest(request:TradeRequest) {\n    this.bookService.updateRequestStatus(request, 'decline')\n  }\n}\n"]}